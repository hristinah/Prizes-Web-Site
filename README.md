# Система за награди 1*10^6

### Условие 
*Million pixel* сайт  за задаване на собствена картинка – според ‚приноса‘ , като администратор за курса определя размера на наградата, и дали картината да се покаже на сайта. При влизане в сайта, се картините се показват в реда им на качване.

### Въведение
*The Million Dollar Homepage* вече е част от историята, но до днес много хора и фирми са оставили отпечатъка си върху нея.  Желанието ми е да направя сайт, на който отличилите се студенти  по Web технологии да могат да оставят своят собствен отпечатък, подобна на горепосочената легендарна страница.

### Използвани технологии
За създаване и обработка на базата с данни са  използвани  phpMyAdmin  и MySQLi.
За обмен на данни между страницата и сървъра, освен action на формите, е използван AJAX, за асинхронно взимане и изпращане на информация. 
И накрая, за създаване на динамична страница е ползван DOM.

### Инсталация и настройки 
1. Преместете папката prizes_project в подпапка на htdocs на XAMPP.
2. При включени Apache и MySQL отидете на страницата http://localhost/phpmyadmin/sql.php?
и създайте нова база данни prizes.
3. Ако имате username и парола за http://localhost/phpmyadmin, или искате базата данни да е с друго име, отидете в подпапка   includes prizes_project, и направете съответните промени в документа dbh.inc .
4. Отворете файлът tablessql.txt папката prizes_project и копирайте съдържанието му в SQL таба на току що създадената база данни и натиснете “Изпълнение”.
5. Отворете http://localhost/........../prizes_project/prizes.php и регистрирайте потребител с име Admin. 

### Кратко ръководство на потребителя 
**За администратора:**<br>
1. Влез в профила си ( с потребителско име Admin) в горният десен ъгъл.
2. За да видиш дали има заявки за награда или изображения, натисни бутонът 
“За одобрение” в горният ляв ъгъл.
3. На отворената страница можеш да видиш още колко пиксела остават за раздаване, и  заявките на останалите потребители.
4. Във формата “Добави пиксели на: ” можеш да избереш на кой потребител-факултетен номер, да дадеш награда, и в колко пиксела ще се състои тя.Когато си готов, натисни “Добави ”.
5. Във формата “Одобри картина: ”  можеш да видиш какви изображения са качени от наградените потребители, но още не са одобрени за показване. За да видиш някое изображение, сложи мишката си над името му в списъка, и то ще се появи в дясно.
Натисни името на изображението, което одобряваш, и натисни “Одобри ”.
6.Когото си готов, можеш да натиснеш “Отпиши ме ”.<br>

**За потребителя:**<br>
1. За да създадеш профил,  натисни “Регистрация”  в горният десен ъгъл.
2. Попълни появилата се форма и натисни “Регистрирай ме”.Ако има проблем с въведената информация, няма да бъдеш регистриран и ще получиш съобщение за проблема , в поле над формата за регистрация.
3. След като получиш съобщение, че си регистриран успешно,влез в профила си , в горният десен ъгъл. 
4. В профила си  можеш да видиш  колко пиксела е наградата ти, и колко от тях все още са свободни.Имай в предвид, че размерът на наградата ти трябва първо да бъде одобрен от администратора, и може да се наложи да изчакаш.
5. Ако имаш свободни пиксели, може да добавиш собствено изображение към сайта с формата “Добави картина”.
6. Първо избери размерите (Ширина х Височина) в съответното поле.Опциите ти зависят от броя оставащи пиксели.
7. Напиши координатите(Надолу х Надясно от горния ляв ъгъл на рамката)– от 0 до 1000, в съответното поле.Позицията, която си написал, ще бъде илюстрирана с мигаща рамка, но ако не отговаря на горните условия, или на това място вече има изображение, ще получиш съобщение, и ще трябва да въведеш нови координати.
8. Накрая, избери изображението, което ще качиш.
9. Когато всички полета във формата са попълнени, може да натиснеш „Добави“.
10. След като изображението ти е одобрено от администратор, то ще се появи върху рамката, и  когато мишката е над него, ще показва твоето потребителско име и фн.

![1](https://user-images.githubusercontent.com/89635038/131635896-7e9004e0-6d6e-4fa6-833f-227feff8fbb1.png)

![3](https://user-images.githubusercontent.com/89635038/131635931-17abf242-b8ba-47e4-8933-abe0b240e58b.png)


### Описание на програмния код 
Самите страници са prizes.php и prizes_admin.php, като форматирането им е в style.css.
Отделни елементи на страниците не се показват при дадени стойности на променливите на сесията: При вече влязъл  потребител не се показва формата за влизане, само за администратора се показва бутонът “За одобрение” и формите в страницата prizes_admin.php, и администраторът няма достъп до формата “Добави картина”.
Изображенията в рамката и опциите в полетата select се добавят чрез DOM в promise функции, след като необходимата им  информация е fetch-ната от съответният php файл  в папката includes:  
* sendimgdata.inc.php – изпраща информацията за качените картини, от която  ги зареждаме в рамката, и определяме на кои позиции са свободни за добавяне на картина, и дали е удобрена, или да се включи в списъка на чакащите удобрение. 
* senduserdata.inc.php – изпраща информация за имената, факултетните номера , и наградите на потребителите, на prizes_admin.php.

И накрая, данни за потребителя се взимат от сесията с php код, и се изкарват чрез echo функции.<br>
<br>
Базата данни има 2 таблици:
* users-информация за потребителя, включваща : id,username,userFN, хеширана парола,колко пиксела е наградата на потребителя, и колко от тях му остават.
* gallery-информация за качените изображения: id,потребителят,който го е качил и неговият факултетен номер,име на файла в папката images(след като е качен-уникално),размери и позиция на изображението в рамката, и дали е одобрено за показване.


PHP файловете с  бизнес логиката са: 
* dbh.inc.php – създава връзката с базата данни и се добавя към всички останали. Играе ролята на config файл.
* sendimgdata.inc.php  и  senduserdata.inc.php – вече са посочени горе.
* signup.inc.php- приема данните от формата за регистрация, и ако те отговарят на изискванията и вече няма потребител със същото име или фн, ги добавя към базата данни, като хешира паролата.
* login.inc.php - приема данните от формата за влизане, и ако има потребител с това име в базата данни, и паролата му отговаря на подадената(с метода password_verify) то добавяме променливи към сесията, с публична информация за потребителя.
* logout.inc.php- унищожава тези променливи.
* upload.inc.php- получава данните от формата за добавяне на картина, заедно с променливите на сесията на потребителя. Ако данните отговарят на изискванията и потребителят действително е в базата данни users,  добавяме информацията за изображението в базата данни, като неодобрено, намаляваме броя свободни пиксели на потребителя и качваме изображението в папката images с уникално име.
* updategallery.inc.php и updateuser.inc.php –променят броя пиксели в таблицата за даден потребител, или  променят изображение на одобрено в таблицата gallery, в зависимост каква опция е избрал администраторът.

### Ограничения и възможности за бъдещо разширение 
Основна насока за бъдещо развитие на проекта би било увеличаване на сигурността на страницата и подобряване на потребителският интерфейс.
